<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Java虚拟机-运行时数据区域 | 饭饭的网络博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Java虚拟机-运行时数据区域</h1><a id="logo" href="/.">饭饭的网络博客</a><p class="description">面朝大海，春暖花开</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Java虚拟机-运行时数据区域</h1><div class="post-meta">Mar 11, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h3 id="1-Java虚拟机运行时数据区域"><a href="#1-Java虚拟机运行时数据区域" class="headerlink" title="1 Java虚拟机运行时数据区域"></a>1 Java虚拟机运行时数据区域</h3><h3 id="1-1-运行时数据区域的总体框架"><a href="#1-1-运行时数据区域的总体框架" class="headerlink" title="1.1 运行时数据区域的总体框架"></a>1.1 运行时数据区域的总体框架</h3><p>Java的运行时数据区域主要由Java堆、方法区和Java虚拟机栈本地方法栈和程序计数器组成。如图所示是Java虚拟机JVM的运行时数据区域框架图。<br><img src="http://www.th7.cn/d/file/p/2014/12/10/2497c4fc56918191c281f9fb366b1839.png" alt=""><br><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1489755911&amp;di=e7880464c40b2aba77b686714ba082f2&amp;imgtype=jpg&amp;er=1&amp;src=http%3A%2F%2Fstatic.cfanz.cn%2Fuploads%2Fpng%2F2015%2F11%2F28%2F21%2FLXD926N081.png" alt=""></p>
<h3 id="1-2-程序计数器"><a href="#1-2-程序计数器" class="headerlink" title="1.2 程序计数器"></a>1.2 程序计数器</h3><p>程序计数器可以看成当前线程的字节码行号指示器，程序计数器指示字节码解释器的下一条需要执行的字节码指令。如果线程正在执行一个Java方法，则程序计数器将指向正在执行的虚拟机字节码指令地址；如果正在执行的是native方法，则这个程序计数器将为空。程序计数器不存在OutOfMemoryError。</p>
<h3 id="1-3-Java虚拟机栈"><a href="#1-3-Java虚拟机栈" class="headerlink" title="1.3 Java虚拟机栈"></a>1.3 Java虚拟机栈</h3><p>Java（Java Virtual Machine Stacks）虚拟机栈时线程独享的，其生命周期与线程的生命周期相同。虚拟机栈描述的是Java方法执行的内存模型：每一个方法在执行的同时会创建一个栈帧（Stack Frame）由于存储局部变量表、操作数栈、动态链接和方法出口等。每一个方法从执行到调用对应着一个栈帧的入栈和出栈的过程。Stack Frame是Java虚拟机栈的基本单位。局部变量表存放了编译期可知的基本数据类型和对象引用类型。在此区域存在两种异常状况：StackOverflowError和OutOfMemoryError两种错误。</p>
<h3 id="1-4-本地方法栈（Native-Method-Stack）"><a href="#1-4-本地方法栈（Native-Method-Stack）" class="headerlink" title="1.4 本地方法栈（Native Method Stack）"></a>1.4 本地方法栈（Native Method Stack）</h3><p>本地方法栈和虚拟机栈的作用非常类似，区别在于虚拟机栈是虚拟机执行Java方法服务，而本地方法栈则为虚拟机使用到的Native方法服务。</p>
<h3 id="1-5-Java堆（Java-Heap）"><a href="#1-5-Java堆（Java-Heap）" class="headerlink" title="1.5 Java堆（Java Heap）"></a>1.5 Java堆（Java Heap）</h3><p>Java堆（Java 堆）是Java虚拟机所管理的内存最大的一块，Java堆是线程共享的内存区域，在虚拟机启动时创建，唯一的目的是存放对象的实例。Java堆是Java垃圾收集器管理的主要区域，由于现在的垃圾收集器基本采用分代收集算法，因此Java堆可以分为新生代和老年代。Java堆中也可以划分出多个线程私有的分配缓冲区（Thread Local Allocation Buffer）。Java堆可以处于物理上不连续的内存空间上，只要逻辑内存连续即可。</p>
<h3 id="1-6-Java方法区（Method-Area）"><a href="#1-6-Java方法区（Method-Area）" class="headerlink" title="1.6 Java方法区（Method Area）"></a>1.6 Java方法区（Method Area）</h3><p>方法区也是线程共享的，用于存储已经被虚拟机加载的类信息、常量、静态变量和即时编译后的代码等数据。Java方法区不需要连续的内存、可以扩展，还可以选择不实现垃圾收集。方法区不能满足内存分配需求时会出现OutOfMemoryError。</p>
<p>运行时常量池（Runtime Constant Pool）是方法区的一部分，用于存储编译期生成的各种字面量和符号引用，比如字符串常量。</p>
<h3 id="1-7-直接内存"><a href="#1-7-直接内存" class="headerlink" title="1.7 直接内存"></a>1.7 直接内存</h3><p>直接内存（Direct Memory）并不是虚拟机运行时数据区的一部分，也可能导致OutOfMemory。</p>
<hr>
<h2 id="2-Hotspot虚拟机对象初探"><a href="#2-Hotspot虚拟机对象初探" class="headerlink" title="2 Hotspot虚拟机对象初探"></a>2 Hotspot虚拟机对象初探</h2><h3 id="2-1-对象的创建"><a href="#2-1-对象的创建" class="headerlink" title="2.1 对象的创建"></a>2.1 对象的创建</h3><p>Java进行对象的过程大致分为以下几个步骤：</p>
<ol>
<li><p>虚拟机遇到一条new指令首先会检查要new的对象类是否已经加载在虚拟中，检查的方法是在常量池中检查是否有没有目标类名的符号引用，如果没有则进行类的加载、解析和初始化。</p>
</li>
<li><p>类加载检查通过后，将为新生对象在Java堆中分配内存（指针碰撞和空闲列表），需要考虑到线程同步问题，解决的方法是线程同步分配内存，另外可以给每一个线程单独分配一块线程独立的内存区域（本地线程分配缓冲，TLAB）。</p>
</li>
<li><p>内存分配完成后，虚拟机将对分配的内存空间初始化为零并进行相关设置。</p>
</li>
<li>执行Java方法的init方法，对象创建完成。<h3 id="2-2-对象内存分布"><a href="#2-2-对象内存分布" class="headerlink" title="2.2 对象内存分布"></a>2.2 对象内存分布</h3>对象的内存分布，是指一个对象在内存中的存储布局，主要分为三个部分：对象头（Header）、实例数据（Instance Data）和对齐填充（Padding）。<br>对象头主要包括两个部分，第一部分用于存储对象自身运行时数据，如哈希码（Hash Code）、GC分带年龄、指向锁记录的指针等信息；第二部分是类型指针，即对象指向自身的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。</li>
</ol>
<p>实例数据是对象真正存储的有效信息，也是在程序代码中所定义的各种类型的字段内容。</p>
<p>对齐填充，起到占位的作用，使得占用的内存大小为8的整数倍。</p>
<h3 id="2-3-对象的访问定位"><a href="#2-3-对象的访问定位" class="headerlink" title="2.3 对象的访问定位"></a>2.3 对象的访问定位</h3><p>对象的定位是指Java虚拟机栈的reference引用定位到Java堆中的对象，有两种方式：句柄访问和直接访问。<br><img src="http://upload-images.jianshu.io/upload_images/3084829-bee8b81a908aa50b.png?imageMogr2/auto-orient/strip%7CimageView2/2" alt=""><br><img src="http://upload-images.jianshu.io/upload_images/3084829-e11f66f8b298cf45.png?imageMogr2/auto-orient/strip%7CimageView2/2" alt=""></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="www.yoursite/2017/03/11/Java虚拟机-运行时数据区域/" data-id="cj04wrolp0002yo11bvocfphj" class="article-share-link">分享到</a><div class="tags"></div><div class="post-nav"><a href="/2017/03/09/Java基础总结-20160309/" class="next">Java基础总结-20160309</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="www.yoursite"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/Java虚拟机-运行时数据区域/">Java虚拟机-运行时数据区域</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/09/Java基础总结-20160309/">Java基础总结-20160309</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/08/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">饭饭的网络博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>